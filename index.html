
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Agenda RE/MAX Soul</title>
<link href="https://fonts.googleapis.com/css2?family=Questrial&display=swap" rel="stylesheet">
<style>
body{
  margin:0;
  font-family:'Questrial',sans-serif;
  background:#f2f4f8;
  display:flex;
  flex-direction:column;
  align-items:center;
}

.topo{
  text-align:center;
  margin-top:20px;
}

.logo{
  width:120px;
}

.marca{
  font-size:32px;
  margin-top:5px;
}

.remax{color:#e11c2a;font-weight:bold}
.barra{color:#0b2a4a;font-weight:bold}
.soul{color:#0b2a4a}

.box{
  margin-top:15px;
  background:white;
  border-radius:16px;
  padding:20px;
  width:360px;
  box-shadow:0 4px 14px rgba(0,0,0,.12);
  border-top:6px solid #0b2a4a;
}

label{display:block;margin-top:12px}

input,button{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid #ccc;
  font-family:'Questrial',sans-serif;
}

#slots{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:6px;
  margin-top:8px;
}

.slot{
  padding:8px;
  text-align:center;
  border-radius:6px;
  background:#eee;
  cursor:pointer;
}

.slot.sel{background:#0b2a4a;color:white}

.slot.ocupado{
  background:#ddd;
  color:#888;
  text-decoration:line-through;
  cursor:not-allowed;
}

button{
  margin-top:14px;
  background:#e11c2a;
  color:white;
  border:none;
  cursor:pointer;
}

button:hover{background:#0b2a4a}

#msg{margin-top:10px;font-size:14px}

.agendaBox{
  margin-top:20px;
  width:360px;
}
</style>
</head>
<body>

<div class="topo">
  <img src="balao.png" class="logo">
  <div class="marca">
    <span class="remax">RE/MAX</span>
    <span class="barra">/</span>
    <span class="soul">Soul</span>
  </div>
</div>

<div class="box">

<label>Data</label>
<input type="date" id="data">

<label>HorÃ¡rio</label>
<div id="slots"></div>

<label>Nome</label>
<input type="text" id="nome">

<label>Motivo</label>
<input type="text" id="motivo">

<button onclick="agendar()">Agendar</button>
<div id="msg"></div>

</div>

<div class="agendaBox">
<h3>Agendamentos confirmados</h3>
<ul id="agenda"></ul>
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbzXVnCMkNRaLxgt2fflEUCVF6tvgICEpptdPBpIpql4ZykE22F_-XdkkD723r6fmz1V/exec";

const HORARIOS=[
"07:30","08:00","08:30","09:00","09:30","10:00",
"10:30","11:00","11:30","12:00","12:30","13:00",
"13:30","14:00","14:30","15:00","15:30","16:00",
"16:30","17:00","17:30","18:00","18:30"
];

let selecionado=null;

document.getElementById("data").addEventListener("change",carregarSlots);

function formatarDataBR(iso){
  const [a,m,d]=iso.split("-");
  return `${d}/${m}/${a.slice(2)}`;
}

async function carregarSlots(){
  const dataISO=document.getElementById("data").value;
  if(!dataISO)return;

  const dataBR=formatarDataBR(dataISO);

  const res=await fetch(API_URL+"?t="+Date.now());
  const agenda=await res.json();

  const ocupados=agenda
    .filter(a=>a.data===dataBR)
    .map(a=>a.hora);

  const div=document.getElementById("slots");
  div.innerHTML="";
  selecionado=null;

  HORARIOS.forEach(h=>{
    const el=document.createElement("div");
    el.className="slot";
    el.textContent=h;

    if(ocupados.includes(h)){
      el.classList.add("ocupado");
      el.title="jÃ¡ reservado";
    }else{
      el.onclick=()=>selecionar(el,h);
    }

    div.appendChild(el);
  });
}

function selecionar(el,h){
  document.querySelectorAll(".slot").forEach(s=>s.classList.remove("sel"));
  el.classList.add("sel");
  selecionado=h;
}

async function agendar(){
  const nome=document.getElementById("nome").value.trim();
  const motivo=document.getElementById("motivo").value.trim();
  const dataISO=document.getElementById("data").value;

  if(!nome||!motivo||!dataISO||!selecionado){
    msg("Preencha todos os campos");
    return;
  }

  const dataBR=formatarDataBR(dataISO);

  const res=await fetch(API_URL,{
    method:"POST",
    body:JSON.stringify({data:dataBR,hora:selecionado,nome,motivo})
  });

  const txt=await res.text();

  if(txt==="erro_ocupado")return msg("HorÃ¡rio jÃ¡ reservado");
  if(txt==="erro_passado")return msg("HorÃ¡rio jÃ¡ passou");

  msg("Agendado com sucesso âœ…");

  document.getElementById("data").value="";
  document.getElementById("nome").value="";
  document.getElementById("motivo").value="";
  document.getElementById("slots").innerHTML="";

  carregarAgenda();
}

async function carregarAgenda(){
  const res=await fetch(API_URL+"?t="+Date.now());
  const dados=await res.json();

  const ul=document.getElementById("agenda");
  ul.innerHTML="";

  dados.forEach(a=>{
    const li=document.createElement("li");
    li.innerHTML=`ðŸ“Œ ${a.nome} â†’ ${a.data} ${a.hora} <em>${a.motivo}</em>`;
    ul.appendChild(li);
  });
}

function msg(t){
  document.getElementById("msg").textContent=t;
}

carregarAgenda();
</script>
</body>
</html>
