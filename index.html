<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>RE/MAX Soul</title>

<link href="https://fonts.googleapis.com/css2?family=Questrial&display=swap" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'Questrial', sans-serif;
  background: #f2f4f8;
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* Logo */
.logo-container {
  text-align: center;
  margin-top: 20px;
}

.balloon {
  width: 120px;
  background: transparent;
  mix-blend-mode: multiply;
  display: block;
}

/* T√≠tulo */
h1 { margin: 6px 0; }
.remax { color:#E11C2A; font-weight:bold; }
.barra { color:#003A8F; font-weight:bold; }
.soul { color:#003A8F; margin-left:6px; }

/* Caixa */
.box {
  margin-top: 15px;
  background: white;
  border-radius: 16px;
  padding: 20px;
  width: 360px;
  box-shadow: 0 4px 14px rgba(0,0,0,.12);
  border-top: 6px solid #003A8F;
}

/* Campos */
label { display:block; margin-top:12px; }

input, select, textarea, button {
  width: 100%;
  padding: 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-family: 'Questrial', sans-serif;
}

/* Bot√£o */
button {
  margin-top: 10px;
  cursor: pointer;
  background-color: #003A8F;
  color: white;
  font-weight: bold;
  transition: background-color 0.3s ease;
}

button:hover { background-color: #0050c8; }

/* Agenda */
#listaAgenda div {
  margin-bottom: 6px;
}
</style>
</head>
<body>

  <img src="balloon.png" class="balloon" alt="Logo RE/MAX Soul">

<div class="logo-container">
  <img src="balloon.png" class="balloon">
  <h1>
    <span class="remax">RE</span>
    <span class="barra">/</span>
    <span class="remax">MAX</span>
    <span class="soul">Soul</span>
  </h1>
</div>

<div class="box">
  <label>Nome</label>
  <input id="nome">

  <label>Data</label>
  <input type="date" id="data">

  <label>Hor√°rio</label>
  <select id="horario"></select>

  <label>Motivo</label>
  <textarea id="motivo"></textarea>

  <button onclick="agendar()">Agendar</button>
  <p id="msg"></p>

  <div class="agenda">
    <h3>Agendamentos confirmados</h3>
    <div id="listaAgenda"></div>
  </div>
</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbz5zmZDP_qsi8gu5f3QZojrltR5vSRK9yCK2TyoPFDSg_Aq-u5cBn7mybD4tsdWPOXE/exec";

const horarios=[
"07:30","08:00","08:30","09:00","09:30","10:00",
"10:30","11:00","11:30","12:00","12:30","13:00",
"13:30","14:00","14:30","15:00","15:30","16:00",
"16:30","17:00","17:30","18:00","18:30"
];

const select=document.getElementById("horario");
const dataInput=document.getElementById("data");

dataInput.addEventListener("change",carregarHorarios);

function formatarBR(iso){
  const [a,m,d]=iso.split("-");
  return `${d}/${m}/${a.slice(2)}`;
}

function normalizarData(v){
  if(!v) return "";
  if(typeof v==="string" && v.includes("/")) return v;

  const d=new Date(v);
  const dia=String(d.getDate()).padStart(2,"0");
  const mes=String(d.getMonth()+1).padStart(2,"0");
  const ano=String(d.getFullYear()).slice(2);
  return `${dia}/${mes}/${ano}`;
}

function normalizarHora(v){
  if(!v) return "";

  if(typeof v==="string"){
    const match=v.match(/(\d{1,2}):(\d{2})/);
    if(match){
      return match[1].padStart(2,"0")+":"+match[2];
    }
  }

  const d=new Date(v);
  if(!isNaN(d)){
    const h=String(d.getHours()).padStart(2,"0");
    const m=String(d.getMinutes()).padStart(2,"0");
    return `${h}:${m}`;
  }

  return "";
}

async function carregarHorarios(){
  const dataISO = dataInput.value;
  if(!dataISO) return;

  const dataBR = formatarBR(dataISO);

  const res = await fetch(API_URL+"?t="+Date.now());
  const dados = await res.json();

  select.innerHTML = "";

  horarios.forEach(h=>{
    const opt = document.createElement("option");
    opt.value = h;

    const ocupado = dados.some(a => 
      normalizarData(a.data) === dataBR &&
      normalizarHora(a.hora) === h
    );

    if(ocupado){
      opt.textContent = h+" (reservado)";
      opt.disabled = true;
    }else{
      opt.textContent = h;
    }

    select.appendChild(opt);
  });
}

async function agendar(){
  const nome=document.getElementById("nome").value.trim();
  const motivo=document.getElementById("motivo").value.trim();
  const dataISO=dataInput.value;
  const hora=select.value;

  if(!nome||!motivo||!dataISO||!hora){
    msg("Preencha todos os campos");
    return;
  }

  const dataBR=formatarBR(dataISO);

  const formData=new URLSearchParams();
  formData.append("data",dataBR);
  formData.append("hora",hora);
  formData.append("nome",nome);
  formData.append("motivo",motivo);

  const res=await fetch(API_URL,{
    method:"POST",
    body:formData
  });

  const txt=await res.text();

  if(txt==="erro_ocupado"){
    msg("Hor√°rio j√° reservado");
    carregarHorarios();
    return;
  }

  msg("Agendado com sucesso ‚úÖ");

  carregarHorarios();
  carregarAgendaPublica();
}

async function carregarAgendaPublica(){
  const res = await fetch(API_URL+"?t="+Date.now());
  const dados = await res.json();

  const container = document.getElementById("listaAgenda");
  container.innerHTML = "";

  const agora = new Date();

  dados.forEach(a=>{
    const data = normalizarData(a.data);
    const hora = normalizarHora(a.hora);
    if(!data || !hora) return;

    const [dia,mes,ano]=data.split("/");

    const dt = new Date(
      2000+parseInt(ano),
      parseInt(mes)-1,
      parseInt(dia),
      parseInt(hora.split(":")[0]),
      parseInt(hora.split(":")[1]),
      0,0
    );

    if(dt < agora) return;

    const horaFormatada = hora.replace(":", "h");

    const item = document.createElement("div");
    item.textContent = `üìå ${dia}/${mes}/${ano} ${horaFormatada} ‚Äî ${a.nome} ${a.motivo}`;
    container.appendChild(item);
  });
}

function msg(t){
  const el=document.getElementById("msg");
  if(el) el.textContent=t;
}

window.addEventListener("DOMContentLoaded",carregarAgendaPublica);
</script>

</body>
</html>
